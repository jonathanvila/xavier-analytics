language: java
notifications:
  email: false
jdk:
  - openjdk8
addons:
  sonarcloud:
    organization: project-xavier
    token:
      secure: $SONAR_TOKEN
install:
  - cp ./configuration/settings.xml $HOME/.m2/settings.xml
  - mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V
jobs:
  include:
    - stage: Test
      script:
        - mvn test -Pcoverage
        - if [env(TRAVIS_PULL_REQUEST) = false AND env(SONAR_TOKEN) IS present]; then sonar-scanner; fi
        - bash <(curl -s https://codecov.io/bash)
    - stage: IntegrationTest
      script:
        - bash <(curl -s -X POST -H "Content-Type:application/json" -H "Accept:application/json" -H "Travis-API-Version:3" -H "Authorization:token $TRAVIS_AP_TOKEN" -d '{"request":{"branch":"master"}}' https://api.travis-ci.com/repo/project-xavier%2Fxavier-integration/requests)
